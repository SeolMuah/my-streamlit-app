# 유압 시스템 이상 탐지 모니터링

> **교육용 프로젝트**: 머신러닝을 활용한 실시간 산업 시스템 모니터링 학습 및 Streamlit 배포 실습을 위한 인터랙티브 데모

## 개요

이 애플리케이션은 머신러닝 알고리즘을 사용하여 유압 시스템의 실시간 모니터링 및 이상 탐지를 제공합니다. OneClass SVM 모델을 활용하여 다양한 센서 데이터를 분석하고 시스템 이상을 감지합니다.

### 학습 목표
- 실시간 센서 데이터 처리 및 시각화
- 머신러닝 기반 이상 탐지 시스템 구현
- 산업용 예측 정비 시스템의 이해
- Streamlit을 활용한 인터랙티브 대시보드 개발
- **Streamlit Cloud를 통한 웹 애플리케이션 배포 실습**

## 시스템 아키텍처

### 데이터 수집
- **압력 센서 (PS1-PS6)**: 100Hz 샘플링 주기
- **온도 센서 (TS1-TS4)**: 1Hz 샘플링 주기  
- **유량 센서 (FS1-FS2)**: 10Hz 샘플링 주기
- **전력 센서 (EPS1)**: 100Hz 샘플링 주기
- **진동 센서 (VS1)**: 1Hz 샘플링 주기
- **효율 센서 (CE, CP, SE)**: 1Hz 샘플링 주기

### 모니터링 구성 요소
- **냉각기**: 냉각 시스템 효율 모니터링
- **밸브**: 유압 밸브 성능 추적
- **펌프**: 펌프 누출 및 성능 분석
- **유압 시스템**: 전체 유압 압력 모니터링

## 주요 기능

### 탐색적 데이터 분석 (EDA)
- 60초 주기로 동기화된 시계열 시각화
- 구성 요소별 상태 분포 분석
- 통계 분석 및 상관관계 매트릭스
- 이상 사이클 감지 및 분석
- 센서 주파수 인식 시간축 표현

### 실시간 모니터링
- OneClass SVM 기반 이상 탐지
- 실시간 센서 데이터 스트리밍
- 구성 요소별 상태 모니터링
- 이상 점수 및 신뢰도 메트릭
- 히스토리 추세 분석

### 데이터 관리
- 캐싱 시스템을 갖춘 통합 데이터 로더
- 시뮬레이션 데이터로 자동 대체
- 데이터 로딩 작업의 진행 상황 추적
- 페이지 간 메모리 효율적 데이터 공유

## 기술적 구현

### 프로젝트 구조
```
project/
├── home.py                 # 메인 대시보드
├── train_model.py          # 모델 훈련 스크립트
├── util/
│   └── data_loader.py      # 중앙화된 데이터 관리
├── pages/
│   ├── 1_EDA.py           # 탐색적 데이터 분석
│   └── 2_Monitoring.py    # 실시간 모니터링
├── data/                   # 센서 데이터 저장소
│   ├── PS1.txt - PS6.txt  # 압력 센서 데이터
│   ├── TS1.txt - TS4.txt  # 온도 센서 데이터
│   ├── FS1.txt - FS2.txt  # 유량 센서 데이터
│   ├── EPS1.txt           # 전력 센서 데이터
│   ├── VS1.txt            # 진동 센서 데이터
│   └── profile.txt        # 구성 요소 상태 라벨
├── models/                 # 머신러닝 모델
│   ├── models.pkl         # 훈련된 OneClass SVM 모델
│   ├── scalers.pkl        # 데이터 정규화 스케일러
│   └── metadata.json      # 모델 메타데이터
├── .streamlit/             # Streamlit 설정
│   ├── config.toml        # UI 테마 및 서버 설정
│   └── secrets.toml       # 환경 변수 및 API 키 (로컬 개발용)
└── requirements.txt
```

### 데이터 처리 파이프라인
1. **데이터 수집**: 주파수 인식 처리를 통한 센서 데이터 로드
2. **특성 추출**: 통계적 특성 (평균, 표준편차, RMS, 왜도, 첨도)
3. **정규화**: 특성 스케일링을 위한 StandardScaler
4. **이상 탐지**: 이상치 감지를 위한 OneClass SVM
5. **시각화**: 시간 동기화된 플롯이 포함된 실시간 대시보드

### 캐싱 시스템
- **센서 데이터**: 1시간 TTL 캐시
- **모델 파일**: 1시간 TTL 리소스 캐시
- **상태 확인**: 1분 TTL 캐시
- **데이터 로더**: 세션 기반 리소스 캐시

## 설치 및 설정

### 필수 조건
- Python 3.8+
- 필요한 패키지 (requirements.txt 참조)
- Google Gemini API 키 (선택사항)

### 의존성 설치
```bash
pip install streamlit pandas numpy plotly scikit-learn scipy
```

### 환경 설정
1. **로컬 개발 환경**:
   ```bash
   # .streamlit/secrets.toml 파일 생성 (선택사항)
   GEMINI_API_KEY="your_api_key_here"
   ```

2. **UI 테마 설정**:
   - `.streamlit/config.toml`에서 색상 및 폰트 커스터마이징
   - 기본 테마: 빨간색 Primary Color, 깔끔한 배경색

### 로컬 환경 실행
```bash
streamlit run home.py
```

### Streamlit Cloud 배포
1. GitHub 리포지토리에 프로젝트 업로드
2. [Streamlit Cloud](https://streamlit.io/cloud) 접속
3. 리포지토리 연결 및 배포 설정
4. 메인 파일 경로: `home.py`
5. **Secrets 설정**: Streamlit Cloud 대시보드에서 환경 변수 설정
   - `GEMINI_API_KEY`: Google Gemini API 키 등록
6. 자동 배포 완료 후 공유 URL 확인

## 사용 방법

### 초기 설정
1. `data/` 디렉토리에 센서 데이터 파일이 있는지 확인
2. `models/` 디렉토리에 모델 파일이 있는지 확인
3. 애플리케이션을 실행하고 시스템 초기화 대기

### 데이터 분석
1. 사이드바에서 EDA 페이지로 이동
2. 분석 유형 및 관심 센서 선택
3. 상세 분석을 위한 사이클 번호 선택
4. 시간 동기화된 시각화 (60초 사이클) 검토

### 실시간 모니터링
1. 사이드바에서 모니터링 페이지 접근
2. 시스템 상태에서 모델 가용성 확인
3. "시작" 버튼 클릭하여 실시간 모니터링 시작
4. 구성 요소 상태 및 이상 점수 모니터링
5. 히스토리 추세 및 통계 검토

## 구성 설정

### Streamlit 설정
**UI 테마 구성** (`.streamlit/config.toml`):
- Primary Color: `#FF4B4B` (빨간색)
- Background Color: `#FFFFFF` (흰색)
- Secondary Background: `#F0F2F6` (연한 회색)
- Text Color: `#262730` (진한 회색)
- Font: Sans Serif

**서버 설정**:
- 최대 업로드 크기: 200MB
- CORS 비활성화

### 센서 주파수
시스템은 다양한 샘플링 주기를 지원합니다:
- 고주파 센서 (100Hz): 압력, 전력
- 중주파 센서 (10Hz): 유량
- 저주파 센서 (1Hz): 온도, 진동, 효율

### 모델 매개변수
- **알고리즘**: OneClass SVM
- **커널**: RBF (방사 기저 함수)
- **오염도**: 구성 요소별 임계값
- **특성 윈도우**: 10초 슬라이딩 윈도우

## 데이터 형식

### 센서 데이터 파일
- 탭으로 구분된 값 (.txt)
- 각 행은 하나의 운영 사이클을 나타냄
- 열 수는 센서 주파수에 따라 달라짐 (60초 × 주파수)

### 라벨 형식
- 구성 요소 상태 지표:
  - **냉각기**: 3 (고장), 20 (효율 감소), 100 (정상)
  - **밸브**: 73 (고장), 80 (심각), 90 (약간 지연), 100 (정상)
  - **펌프**: 0 (정상), 1 (약한 누출), 2 (심각한 누출)
  - **유압**: 90 (고장), 100 (낮음), 115 (약간 낮음), 130 (정상)

## 사용된 기술 스택

### 백엔드
- **Python**: 핵심 프로그래밍 언어
- **Streamlit**: 웹 애플리케이션 프레임워크
- **scikit-learn**: 머신러닝 라이브러리
- **pandas**: 데이터 처리 및 분석
- **numpy**: 수치 계산

### 프론트엔드
- **Plotly**: 인터랙티브 시각화
- **Streamlit Components**: UI 구성 요소
- **CSS**: 스타일링 및 레이아웃

### 배포 환경
- **Streamlit Cloud**: 웹 애플리케이션 호스팅
- **GitHub**: 소스 코드 관리 및 CI/CD 연동
- **Google Gemini API**: AI 기반 분석 지원 (선택사항)

## 보안 고려사항

### API 키 관리
- **로컬 개발**: `.streamlit/secrets.toml` 파일 사용
- **클라우드 배포**: Streamlit Cloud Secrets 기능 활용
- **중요**: `secrets.toml` 파일은 `.gitignore`에 추가하여 Git 추적 방지

### 환경 변수 설정
```toml
# .streamlit/secrets.toml (로컬 개발용)
GEMINI_API_KEY = "your_api_key_here"
```

**주의**: 실제 API 키는 공개 저장소에 업로드하지 마세요!